<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>ë²½ í†µê³¼ ê²Œì„</title>
  <link rel="stylesheet" href="/static/style.css">
</head>
<body>
  <h1>ğŸ§ ë²½ í†µê³¼ ê²Œì„</h1>
  <video id="video" autoplay playsinline></video>
  <canvas id="canvas"></canvas>
  <div id="timer">5</div>
  <div id="result"></div>

  <script>
    const video = document.getElementById('video');
    const canvas = document.getElementById('canvas');
    const resultDiv = document.getElementById('result');
    const timerDiv = document.getElementById('timer');

    // navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
    //   video.srcObject = stream;
    // });

    navigator.mediaDevices.getUserMedia({ video: true }).then(stream => {
      const video = document.getElementById("video");
      video.srcObject = stream;
      console.log("âœ… ì¹´ë©”ë¼ ì—°ê²° ì„±ê³µ");
      })
      .catch(err => {
        console.error("âŒ ì¹´ë©”ë¼ ì—°ê²° ì‹¤íŒ¨:", err);
        alert("ì¹´ë©”ë¼ ì ‘ê·¼ì´ ì°¨ë‹¨ë˜ì—ˆìŠµë‹ˆë‹¤. ë¸Œë¼ìš°ì € ê¶Œí•œì„ í™•ì¸í•´ì£¼ì„¸ìš”.");
      });

    function captureAndSend() {
      canvas.width = video.videoWidth;
      canvas.height = video.videoHeight;
      const ctx = canvas.getContext('2d');
      ctx.drawImage(video, 0, 0);

      canvas.toBlob(blob => {
        const formData = new FormData();
        formData.append("image", blob, "frame.jpg");

        fetch("/pose/process", {
          method: "POST",
          body: formData
        })
        .then(res => res.json())
        .then(data => {
          resultDiv.textContent = data.result.toUpperCase();
        });
      }, 'image/jpeg');
    }

    function startTimer() {
      let count = 5;
      timerDiv.textContent = count;
      resultDiv.textContent = '';
      const interval = setInterval(() => {
        count--;
        timerDiv.textContent = count;
        if (count === 0) {
          clearInterval(interval);
          captureAndSend();
        }
      }, 1000);
    }

    window.onload = startTimer;
  </script>
</body>
</html>
